(()=>{var e={779:()=>{document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#main-content"),t=document.querySelector(".skip-to-content");e&&t&&t.addEventListener("click",(function(n){n.preventDefault(),t.blur(),e.focus(),e.scrollIntoView()}))}))}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};n.r(e),n.d(e,{checkAuth:()=>c,checkUnauth:()=>d,getAccessToken:()=>a,isAuthenticated:()=>l,putAccessToken:()=>r,removeAccessToken:()=>s});var t={};n.r(t),n.d(t,{NewStory:()=>v,getLogin:()=>p,getRegistered:()=>h,getStories:()=>m,getStoryDetail:()=>g,subscribePushNotification:()=>y,unsubscribePushNotification:()=>w});class o{#e;#t;constructor(e){let{view:t,model:n}=e;this.#e=t,this.#t=n}async initialGallery(){this.#e.showLoading();try{const e=await this.#t.getStories();!e.error&&e.data&&e.data.listStory?this.#e.populateGallery(e.data.listStory):(console.error("Failed load story:",e.error),this.#e.populateFallbackGallery())}catch(e){console.error("Error load story:",e),this.#e.populateGalleryError(e.message)}finally{this.#e.hideLoading()}}}const i={ACCESS_TOKEN_KEY:"accessToken",BASE_URL:"https://story-api.dicoding.dev/v1",MAP_SERVICE_API_KEY:"WdRDTEgvtcai1ej5yn7S",VAPID_PUBLIC_KEY:"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",PUSH_NOTIFICATION_BASE_URL:"https://story-api.dicoding.dev/v1/notifications"};function a(){try{if(!i.ACCESS_TOKEN_KEY||"string"!=typeof i.ACCESS_TOKEN_KEY)return console.error("getAccessToken: CONFIG.ACCESS_TOKEN_KEY tidak valid"),null;const e=localStorage.getItem(i.ACCESS_TOKEN_KEY);return e&&""!==e.trim()?e:null}catch(e){return console.error("getAccessToken: error while retrieving token",e),null}}function r(e){try{return i.ACCESS_TOKEN_KEY&&"string"==typeof i.ACCESS_TOKEN_KEY?e&&"string"==typeof e?(localStorage.setItem(i.ACCESS_TOKEN_KEY,e),!0):(console.error("putAccessToken: token Invalid"),!1):(console.error("putAccessToken: CONFIG.ACCESS_TOKEN_KEY Invalid"),!1)}catch(e){return console.error("putAccessToken: error while storing token",e),!1}}function s(){try{if(!i.ACCESS_TOKEN_KEY||"string"!=typeof i.ACCESS_TOKEN_KEY)return void console.error("removeAccessToken: CONFIG.ACCESS_TOKEN_KEY Invalid");localStorage.removeItem(i.ACCESS_TOKEN_KEY)}catch(e){console.error("removeAccessToken: error while removing token",e)}}function l(){return!!a()}function c(){try{return!!l()||(window.location.hash="#/login",!1)}catch(e){return console.error("checkAuth:error while checking authentication",e),!1}}function d(){try{return!l()||(window.location.hash="#/",!1)}catch(e){return console.error("checkUnauth:error while checking authentication",e),!1}}const u={REGISTER:`${i.BASE_URL}/register`,LOGIN:`${i.BASE_URL}/login`,STORIES:`${i.BASE_URL}/stories`,STORIES_DETAIL:e=>`${i.BASE_URL}/stories/${e}`,SUBSCRIBE:`${i.PUSH_NOTIFICATION_BASE_URL}/subscribe`};async function h(e){let{name:t,email:n,password:o}=e;const i=JSON.stringify({name:t,email:n,password:o});try{const e=await fetch(u.REGISTER,{method:"POST",headers:{"Content-Type":"application/json"},body:i}),t=await e.json();return e.ok?{error:!1,data:t}:{error:!0,data:t}}catch(e){return{error:!0,data:{message:"Network error"}}}}async function p(e){let{email:t,password:n}=e;const o=JSON.stringify({email:t,password:n});try{const e=await fetch(u.LOGIN,{method:"POST",headers:{"Content-Type":"application/json"},body:o}),t=await e.json();if(!e.ok)return{error:!0,data:t};const n=t.loginResult?.token;return n&&r(n),{error:!1,data:t}}catch(e){return{error:!0,data:{message:"Network error"}}}}async function m(){let{page:e=1,size:t=10,location:n=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=a();if(!o||"null"===o||"undefined"===o)return{error:!0,data:{message:"Unauthorized: No valid access token"}};try{const i=new URLSearchParams({page:e,size:t,location:n}),r=await fetch(`${u.STORIES}?${i}`,{headers:{Authorization:`Bearer ${o}`}}),s=await r.json();return console.log("getStories response:",r.status,s),console.log("Access Token:",a()),r.ok?{error:!1,data:s}:{error:!0,data:s}}catch(e){return{error:!0,data:{message:"Network error"}}}}async function g(e){try{const t=a();if(!t)return{error:!0,data:{message:"No authentication token found"}};const n=await fetch(u.STORIES_DETAIL(e),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),o=await n.json();return n.ok?{error:!1,data:o}:{error:!0,data:o}}catch(e){return{error:!0,data:{message:"Network error"}}}}async function v(e){let{description:t,photo:n,lat:o,lon:i}=e;try{const e=a(),r=new FormData;r.append("description",t),r.append("photo",n),null!=o&&r.append("lat",o),null!=i&&r.append("lon",i);const s=await fetch(u.STORIES,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:r}),l=await s.json();return s.ok?{error:!1,data:l}:{error:!0,data:l}}catch(e){return{error:!0,data:{message:"Network error"}}}}async function y(e){const t=a(),n={endpoint:e.endpoint,keys:e.keys},o=await fetch(u.SUBSCRIBE,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(n)}),i=await o.json();return 201!==o.status&&200!==o.status?(console.error("Gagal subscribe:",i.message),{error:!0,data:i}):{error:!1,data:i}}async function w(e){const t=a();return(await fetch(u.SUBSCRIBE,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({endpoint:e})})).json()}class b{#e;#t;#n;constructor(e){let{view:t,model:n,authModel:o}=e;this.#e=t,this.#t=n,this.#n=o}async getLogin(e){let{email:t,password:n}=e;this.#e.showSubmitLoadingButton();try{const e=await this.#t.getLogin({email:t,password:n});if(e.error){const t=e.data?.message||"Failed Login. Please try again.";return void this.#e.loginFailed(t)}const o=e.data?.loginResult?.token,i=e.data?.message||"Login Success";if(!o||"string"!=typeof o)return void this.#e.loginFailed("Login token not found or invalid. Please try again..");this.#n.putAccessToken(o),this.#e.loginSuccessfully(i,e.data)}catch(e){this.#e.loginFailed(e?.message||"Failed Login. Please try again.")}finally{this.#e.hideSubmitLoadingButton()}}}class f{#e;#t;constructor(e){let{view:t,model:n}=e;this.#e=t,this.#t=n}async getRegistered(e){let{name:t,email:n,password:o}=e;this.#e.showSubmitLoadingButton();try{const e=await this.#t.getRegistered({name:t,email:n,password:o});if(!e.ok)return console.error("getRegistered response:",e),void this.#e.registeredFailed(e.message);this.#e.registeredSuccessfully(e.message,e.data)}catch(e){console.error("getRegistered error:",e),this.#e.registeredFailed(e.message)}finally{this.#e.hideSubmitLoadingButton()}}}class E{#e;#o;#i;#a=null;#r=!1;constructor(e){let{view:t,camera:n,map:o}=e;this.#e=t,this.#i=n,this.#o=o}async initialize(){await new Promise((e=>{this.#e.loadMapTilerResources(e)})),this.initializeListeners(),await this.initializeMap()}initializeListeners(){this.#e.bindPhotoInputButton(this.handlePhotoInputClick.bind(this)),this.#e.bindPhotoInput(this.handlePhotoChange.bind(this)),this.#e.bindCameraToggle(this.handleCameraToggle.bind(this)),this.#e.bindTakePhotoButton(this.handleTakePhoto.bind(this)),this.#e.bindFormSubmit(this.handleFormSubmit.bind(this)),this.#e.bindLocationInputs(this.updateMarkerFromInputs.bind(this))}handlePhotoInputClick(){this.#e.clickPhotoInput(),this.#r&&(this.#i.stop(),this.#e.hideCameraContainer(),this.#e.updateCameraButtonText("Open Camera"),this.#r=!1)}handlePhotoChange(e){e&&(this.#a=e,this.#e.showPhotoPreview(e),this.#r&&(this.#i.stop(),this.#e.hideCameraContainer(),this.#e.updateCameraButtonText("Open Camera"),this.#r=!1))}async handleCameraToggle(){this.#r?(this.#i.stop(),this.#e.hideCameraContainer(),this.#e.updateCameraButtonText("Open Camera"),this.#r=!1):(this.#e.resetPhotoInput(),this.#i.start()?(this.#e.showCameraContainer(),this.#e.hidePhotoPreview(),this.#e.updateCameraButtonText("Close Camera"),this.#r=!0):this.#e.showAlert("Could not access camera"))}async handleTakePhoto(){this.#a=await this.#i.takePhoto(),this.#a&&(this.#e.showPhotoPreview(this.#a),this.#i.stop(),this.#e.hideCameraContainer(),this.#e.updateCameraButtonText("Open Camera"),this.#r=!1)}async handleFormSubmit(e){const{description:t,photoFile:n,latitude:o,longitude:i}=e,a=this.#a||n;if(a)try{const e=await v({description:t,photo:a,lat:o,lon:i});e.error?this.#e.showAlert(`Error: ${e.data.message}`):(this.#e.showAlert("Story uploaded successfully!"),this.#e.navigateToHome())}catch(e){this.#e.showAlert("An error occurred while uploading the story"),console.error(e)}finally{this.#r&&this.#i.stop()}else this.#e.showAlert("Please select or take a photo")}async initializeMap(){"undefined"==typeof maplibregl&&await new Promise((e=>{const t=setInterval((()=>{"undefined"!=typeof maplibregl&&(clearInterval(t),e())}),100)})),this.#e.showMapLoading();const e=i.MAP_SERVICE_API_KEY,{latValue:t,lngValue:n}=this.#e.getLocationValues(),o=t?parseFloat(t):-6.175389,a=n?parseFloat(n):106.827139;try{const t=new maplibregl.Map({container:"map",style:`https://api.maptiler.com/maps/streets/style.json?key=${e}`,center:[a,o],zoom:13,attributionControl:!1});t.on("load",(()=>{this.#e.clearMapLoading()})),t.addControl(new maplibregl.AttributionControl({compact:!0,customAttribution:'<span style="color: #333">Mark the location</span>'})),t.addControl(new maplibregl.NavigationControl,"top-right");const n=this.#e.createMarkerElement(),i=new maplibregl.Marker({element:n,draggable:!0,anchor:"bottom"}).setLngLat([a,o]).addTo(t);this.#o=t,this.marker=i,i.on("dragend",(()=>{const e=i.getLngLat();this.#e.updateLocationInputs(e.lat.toFixed(6),e.lng.toFixed(6))})),t.on("click",(e=>{const{lng:t,lat:n}=e.lngLat;i.setLngLat([t,n]),this.#e.updateLocationInputs(n.toFixed(6),t.toFixed(6))}))}catch(e){console.error("Error initializing map:",e),this.#e.showMapError()}}updateMarkerFromInputs(){const{latValue:e,lngValue:t}=this.#e.getLocationValues(),n=e?parseFloat(e):null,o=t?parseFloat(t):null;null!==n&&null!==o&&!isNaN(n)&&!isNaN(o)&&this.marker&&this.#o?(this.marker.setLngLat([o,n]),this.#o.flyTo({center:[o,n],zoom:13})):this.marker&&this.marker.remove()}}const k=class{constructor(e,t){this.video=e,this.canvas=t,this.stream=null,this.photoFile=null}async start(){try{return this.stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),this.video.srcObject=this.stream,this.video.play(),!0}catch(e){return console.error("Error access camera:",e),!1}}stop(){this.stream&&(this.stream.getTracks().forEach((e=>e.stop())),this.video.srcObject=null)}takePhoto(){if(!this.stream)return null;const e=this.canvas.getContext("2d");return this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight,e.drawImage(this.video,0,0,this.canvas.width,this.canvas.height),new Promise((e=>{this.canvas.toBlob((t=>{this.photoFile=new File([t],"photo.jpg",{type:"image/jpeg"}),e(this.photoFile)}),"image/jpeg",.95)}))}getPhotoFile(){return this.photoFile}};let S,B;const L=new WeakMap,I=new WeakMap,C=new WeakMap,T=new WeakMap,P=new WeakMap;let _={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return I.get(e);if("objectStoreNames"===t)return e.objectStoreNames||C.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return A(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function M(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(B||(B=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(F(this),e),A(L.get(this))}:function(...e){return A(t.apply(F(this),e))}:function(e,...n){const o=t.call(F(this),e,...n);return C.set(o,e.sort?e.sort():[e]),A(o)}:(e instanceof IDBTransaction&&function(e){if(I.has(e))return;const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{t(),o()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)}));I.set(e,t)}(e),n=e,(S||(S=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,_):e);var t,n}function A(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{t(A(e.result)),o()},a=()=>{n(e.error),o()};e.addEventListener("success",i),e.addEventListener("error",a)}));return t.then((t=>{t instanceof IDBCursor&&L.set(t,e)})).catch((()=>{})),P.set(t,e),t}(e);if(T.has(e))return T.get(e);const t=M(e);return t!==e&&(T.set(e,t),P.set(t,e)),t}const F=e=>P.get(e),D=["get","getKey","getAll","getAllKeys","count"],x=["put","add","delete","clear"],N=new Map;function O(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(N.get(t))return N.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,i=x.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!i&&!D.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,i?"readwrite":"readonly");let r=a.store;return o&&(r=r.index(t.shift())),(await Promise.all([r[n](...t),i&&a.done]))[0]};return N.set(t,a),a}var R;R=_,_={...R,get:(e,t,n)=>O(e,t)||R.get(e,t,n),has:(e,t)=>!!O(e,t)||R.has(e,t)};const H="bookmarked-stories",$=function(e,t,{blocked:n,upgrade:o,blocking:i,terminated:a}={}){const r=indexedDB.open(e,t),s=A(r);return o&&r.addEventListener("upgradeneeded",(e=>{o(A(r.result),e.oldVersion,e.newVersion,A(r.transaction),e)})),n&&r.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),s.then((e=>{a&&e.addEventListener("close",(()=>a())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),s}("storyverse-db",1,{upgrade(e){e.createObjectStore(H,{keyPath:"id"})}}),j={getStory:async e=>e?(await $).get(H,e):null,getAllStories:async()=>(await $).getAll(H),async putStory(e){if(e.id)return(await $).put(H,e)},async deleteStory(e){if(e)return(await $).delete(H,e)}};class U{#e;#t;#s;constructor(e){let{view:t,model:n}=e;this.#e=t,this.#t=n}async init(e){this.#s=e,this.#e.loadMapScripts(),await this.#l(),await this.#c()}async#c(){const e=await this.#d(this.#s);this.#e.showBookmarkButton(e)}async#d(e){return!!await j.getStory(e)}async handleBookmarkClick(){const e=await this.#d(this.#s),t=await this.#t.getStoryDetail(this.#s);e?(await j.deleteStory(this.#s),console.log("Story dihapus dari bookmark")):(await j.putStory(t.data.story),console.log("Story disimpan ke bookmark")),await this.#c()}async#l(){if(this.#s)try{const e=await this.#t.getStoryDetail(this.#s);if(e.error||!e.data.story)return void this.#e.showError(e.data.message||"Failed to load story detail");const t=e.data.story;this.#e.addStoryDetail(t),t.lat&&t.lon&&this.#e.waitForMapToBeReady(parseFloat(t.lat),parseFloat(t.lon))}catch(e){this.#e.showError("An unexpected error occurred"),console.error("Error loading story detail:",e)}else this.#e.showError("Story not found")}}class K{#e;#t;constructor(e){let{view:t,model:n}=e;this.#e=t,this.#t=n}async initialGallery(){this.#e.showLoading();try{const e=await this.#t.getAllStories();this.#e.populateBookmarkGallery(e)}catch(e){console.error(e),this.#e.populateGalleryError(e.message)}finally{this.#e.hideLoading()}}}const V=e=>({page:new e,check:c}),Y=e=>({page:new e,check:d}),z={"/":V(class{#u=null;constructor(){this.#u=new o({view:this,model:{getStories:m}})}async render(){return'\n      <section class="home-container">\n        <div class="header-home">\n          <p class="instruction-text-home">Click Post To Explore More</p>\n          <a href="#/addStory-page" class="upload-btn">Add Story</a>\n        </div>\n        <h1 class="story-title">StoryVerse Stories</h1>\n\n        <div id="gallery" class="gallery">\n          <div class="loading-indicator">Load story...</div>\n        </div>\n      </section>\n    '}async afterRender(){await this.#u.initialGallery(),this.setupPhotoClickHandlers()}setupPhotoClickHandlers(){const e=document.getElementById("gallery");e&&e.addEventListener("click",(e=>{const t=e.target.closest(".photo-container");if(!t)return;e.preventDefault();const n=t.getAttribute("href");document.startViewTransition?document.startViewTransition((()=>{window.location.hash=n})):window.location.hash=n}))}showLoading(){const e=document.getElementById("gallery");e&&(e.innerHTML='<div class="loading-indicator">Load story...</div>')}hideLoading(){const e=document.querySelector(".loading-indicator");e&&e.remove()}populateGallery(e){const t=document.getElementById("gallery");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<div class="empty-gallery">No story Ready</div>');const n=e.map(((e,t)=>{const n=e.description.length>100?e.description.substring(0,100)+"...":e.description,o=new Date(e.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return`\n          <div class="photo-item">\n            <a href="#/detail-page/${e.id}" class="photo-container">\n              <img src="${e.photoUrl}" alt="story-photo-${t+1}" />\n            </a>\n            <div class="photo-info">\n              <h3 class="photo-name">${e.name}</h3>\n              <p class="photo-description">${n}</p>\n              <div class="photo-date">${o}</div>\n            </div>\n          </div>\n        `})).join("");t.innerHTML=n}populateGalleryError(e){const t=document.getElementById("gallery");if(t){t.innerHTML=`\n        <div class="error-container">\n          <p class="error-message">${e||"Failed to load story. Please try again later."}</p>\n          <button id="retry-button" class="retry-button">Try Again </button>\n        </div>\n      `;const n=document.getElementById("retry-button");n&&n.addEventListener("click",(()=>{this.#u.initialGallery()}))}}populateFallbackGallery(){const e=document.getElementById("gallery");e&&(e.innerHTML='\n        <div class="photo-item">\n          <a href="#/details_photo" class="photo-container">\n            <img src="hhttps://picsum.photos/seed/storyverse/200/300 alt="story-photo" />\n          </a>\n          <div class="photo-info">\n            <h3 class="photo-name">Unknown</h3>\n            <p class="photo-description">Unknown description.</p>\n            <div class="photo-date">Unknown date</div>\n          </div>\n        </div>\n      ')}}),"/login":Y(class{#u=null;#h={form:null,email:null,password:null,errorMessage:null,submitButton:null};async render(){return'\n     <section class="story-container">\n      <div class="auth-form-container">\n        <form id="login-form" class="story-form">\n          <div class="form-control">\n            <label for="email-input" class="form-label">Email</label>\n            <input id="email-input" name="email" type="email" placeholder="Example: nama@email.com" required>\n          </div>\n\n          <div class="form-control">\n            <label for="password-input" class="form-label">Password</label>\n            <input id="password-input" name="password" type="password" placeholder="Enter password" required>\n          </div>\n\n          <button id="submit-button" type="submit" class="btn">Login</button>\n\n          <div class="auth-footer">\n            <span>Don\'t have an account yet? </span>\n            <a href="#/register" class="auth-link">Register Here</a>\n          </div>\n        </form>\n        <div id="error-message" class="error-message" style="display: none;"></div>\n  </div>\n</section>\n\n    '}async afterRender(){this.#u=new b({view:this,model:t,authModel:e}),this.#p(),this.#m()}#p(){this.#h={form:document.getElementById("login-form"),email:document.getElementById("email-input"),password:document.getElementById("password-input"),errorMessage:document.getElementById("error-message"),submitButton:document.getElementById("submit-button")}}#m(){this.#h.form.addEventListener("submit",(async e=>{e.preventDefault(),await this.#u.getLogin(this.getFormData())}))}getFormData(){return{email:this.#h.email.value,password:this.#h.password.value}}loginSuccessfully(e,t){console.log("Login success:",e,t),this.navigateTo("/")}loginFailed(e){this.#h.errorMessage.textContent=e,this.#h.errorMessage.style.display="block"}showSubmitLoadingButton(){this.#h.submitButton.disabled=!0,this.#h.submitButton.textContent="Load...."}hideSubmitLoadingButton(){this.#h.submitButton.disabled=!1,this.#h.submitButton.textContent="Login"}navigateTo(e){window.location.hash=e}}),"/register":Y(class{#u=null;async render(){return'\n        <section class="register-container">\n            <div class="register-form-container">\n                <h1 class="register__title">Create Account</h1>\n\n                <form id="register-form" class="register-form">\n                    <div class="form-control">\n                        <label for="name-input" class="register-form__name-title">Name</label>\n\n                        <div class="register-form__title-container">\n                            <input id="name-input" type="text" name="name" placeholder="Enter Name">\n                        </div>\n                    </div>\n                    <div class="form-control">\n                        <label for="email-input" class="register-form__email-title">Email</label>\n\n                        <div class="register-form__title-container">\n                            <input id="email-input" type="email" name="email" placeholder="Example: nama@email.com">\n                        </div>\n                    </div>\n                    <div class="form-control">\n                        <label for="password-input" class="register-form__password-title">Password</label>\n                        <div class="register-form__title-container">\n                            <input id="password-input" type="password" name="password" placeholder="Enter New Password">\n                        </div>\n                    </div>\n                    <div class="form-buttons register-form__form-buttons">\n                        <div id="submit-button-container">\n                            <button id="submit-button" class="btn" type="submit">Register Account</button>\n                        </div>\n                    </div>\n                    <div class="auth-footer">\n                        <span>Already have an account? </span>\n                        <a href="#/login" class="auth-link">Login here</a>\n                    </div>\n                    <div id="error-message" class="error-message" style="display: none;"></div>\n                </form>\n            </div>\n        </section>\n        '}async afterRender(){this.#u=new f({view:this,model:t}),this.#m()}#m(){document.getElementById("register-form").addEventListener("submit",(async e=>{e.preventDefault();const t={name:document.getElementById("name-input").value,email:document.getElementById("email-input").value,password:document.getElementById("password-input").value};await this.#u.getRegistered(t)}))}registeredSuccessfully(e,t){console.log("registeredSuccessfully: data:",t),alert(e),location.hash="/login"}registeredFailed(e){alert(e)}showSubmitLoadingButton(){document.getElementById("submit-button-container").innerHTML='\n            <button class="btn" type="submit" disabled>\n                <i class="fas fa-spinner loader-button"></i> Register Account </button>\n        '}hideSubmitLoadingButton(){document.getElementById("submit-button-container").innerHTML='\n            <button class="btn" type="submit">Register Account</button>\n        '}}),"/addStory-page":V(class{#u;#i;#g={};async render(){return'\n     <section class="story-verse-container">\n        <div class="header">\n          <p class="instruction-text-add">Share Your StoryVerse</p>\n          <a href="#/" class="back-btn">Back to home</a>\n        </div>\n\n        <h1 class="story-title">STORYVERSE POST STORY</h1>\n\n        <div class="upload-form-container">\n          <form id="upload-form" class="story-form">\n            \x3c!-- Description --\x3e\n            <div class="form-control-story">\n              <label for="description-input" class="form-label">Your Story</label>\n              <div class="input-container">\n                <textarea\n                  id="description-input"\n                  name="description"\n                  placeholder="What are you witnessing? Whatâ€™s happening around you? Let others know. Share your stories and broaden the horizons of our StoryVerse together."\n                  required\n                ></textarea>\n              </div>\n            </div>\n\n            \x3c!-- Image Upload --\x3e\n            <div class="form-control">\n              <label class="form-label">Upload Image</label>\n              <div id="photo-more-info">Choose or capture an image related to your story</div>\n              <div class="documentation-container">\n                <div class="documentation-buttons">\n                  <button id="photo-input-button" class="btn btn-outline" type="button">Select Image</button>\n                  <button id="camera-toggle-button" class="btn btn-outline" type="button">Use Camera</button>\n                  <input\n                    id="photo-input"\n                    name="photo"\n                    type="file"\n                    accept="image/*"\n                    hidden\n                    aria-describedby="photo-more-info"\n                  >\n                </div>\n\n                <div id="camera-container" style="display: none; margin-top: 20px; position: relative;">\n                  <video id="camera-video" width="100%" autoplay></video>\n                  <canvas id="camera-canvas" style="display: none;"></canvas>\n                  <div style="display: flex; gap: 10px; margin-top: 10px;">\n                    <button id="take-photo-button" class="btn" type="button">Capture Photo</button>\n                  </div>\n                </div>\n\n                <div id="photo-preview-container" class="photo-preview">\n                  <img id="photo-preview" style="max-width: 100%; max-height: 300px; display: none;" />\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- Location --\x3e\n            <div class="form-control">\n              <label class="form-label">Location</label>\n              <div class="location-container">\n                <div class="location-map-container">\n                  <div id="map" class="location-map"></div>\n                  <div id="map-loading-container"></div>\n                </div>\n                <div class="location-coords">\n                  <input type="number" id="latitude-input" name="latitude" placeholder="Latitude" step="any">\n                  <input type="number" id="longitude-input" name="longitude" placeholder="Longitude" step="any">\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- Submit --\x3e\n            <div class="form-buttons">\n              <span id="submit-button-container">\n                <button class="btn" type="submit">Submit Story</button>\n              </span>\n            </div>\n          </form>\n        </div>\n      </section>\n    '}async afterRender(){this.#v(),this.#y(),this.#i=new k(this.#g.video,this.#g.canvas),this.#u=new E({view:this,camera:this.#i,map:null}),await this.#u.initialize()}#v(){this.#g={video:document.getElementById("camera-video"),canvas:document.getElementById("camera-canvas"),photoInputButton:document.getElementById("photo-input-button"),cameraToggleButton:document.getElementById("camera-toggle-button"),photoInput:document.getElementById("photo-input"),cameraContainer:document.getElementById("camera-container"),takePhotoButton:document.getElementById("take-photo-button"),photoPreviewContainer:document.getElementById("photo-preview-container"),photoPreview:document.getElementById("photo-preview"),map:document.getElementById("map"),mapLoadingContainer:document.getElementById("map-loading-container"),latitudeInput:document.getElementById("latitude-input"),longitudeInput:document.getElementById("longitude-input"),submitButtonContainer:document.getElementById("submit-button-container"),uploadForm:document.getElementById("upload-form"),descriptionInput:document.getElementById("description-input")}}#y(){const e=document.querySelector(".back-btn");e&&e.addEventListener("click",(e=>{e.preventDefault(),document.startViewTransition?document.startViewTransition((()=>{window.location.hash="#/"})):window.location.hash="#/"}))}bindPhotoInputButton(e){this.#g.photoInputButton.addEventListener("click",e)}bindPhotoInput(e){this.#g.photoInput.addEventListener("change",(t=>{const n=t.target.files[0];e(n)}))}bindCameraToggle(e){this.#g.cameraToggleButton.addEventListener("click",e)}bindTakePhotoButton(e){this.#g.takePhotoButton.addEventListener("click",e)}bindFormSubmit(e){this.#g.uploadForm.addEventListener("submit",(t=>{t.preventDefault();const n={description:this.#g.descriptionInput.value,photoFile:this.#g.photoInput.files[0],latitude:this.#g.latitudeInput.value?parseFloat(this.#g.latitudeInput.value):null,longitude:this.#g.longitudeInput.value?parseFloat(this.#g.longitudeInput.value):null};e(n)}))}bindLocationInputs(e){this.#g.latitudeInput.addEventListener("change",e),this.#g.longitudeInput.addEventListener("change",e)}clickPhotoInput(){this.#g.photoInput.click()}resetPhotoInput(){this.#g.photoInput.value=""}showCameraContainer(){this.#g.cameraContainer.style.display="block"}hideCameraContainer(){this.#g.cameraContainer.style.display="none"}hidePhotoPreview(){this.#g.photoPreview.style.display="none"}updateCameraButtonText(e){this.#g.cameraToggleButton.textContent=e}showPhotoPreview(e){const t=new FileReader;t.onload=e=>{this.#g.photoPreview.src=e.target.result,this.#g.photoPreview.style.display="block"},t.readAsDataURL(e)}showAlert(e){alert(e)}showMapLoading(){this.#g.mapLoadingContainer.innerHTML='\n      <div style="text-align: center;">Loading haunted map locations...</div>\n    '}clearMapLoading(){this.#g.mapLoadingContainer.innerHTML=""}showMapError(){this.#g.mapLoadingContainer.innerHTML='\n      <div style="text-align: center; color: red;">Failed to load the map. Please try again later.</div>\n    '}getLocationValues(){return{latValue:this.#g.latitudeInput.value,lngValue:this.#g.longitudeInput.value}}updateLocationInputs(e,t){this.#g.latitudeInput.value=e,this.#g.longitudeInput.value=t}navigateToHome(){window.location.hash="#/"}hideMapLoading(){this.clearMapLoading()}destroy(){this.#i&&this.#i.stop()}loadMapTilerResources(e){const t=document.createElement("link");t.rel="stylesheet",t.href="https://cdn.maptiler.com/maplibre-gl-js/v2.4.0/maplibre-gl.css",document.head.appendChild(t);const n=document.createElement("script");n.src="https://cdn.maptiler.com/maplibre-gl-js/v2.4.0/maplibre-gl.js";const o=setTimeout((()=>{console.warn("MapTiler script loading timed out"),e()}),1e4);n.onload=()=>{clearTimeout(o),e()},document.head.appendChild(n)}createMarkerElement(){const e=document.createElement("div");return e.className="custom-marker",e.innerHTML='\n    <svg width="30" height="45" viewBox="0 0 30 45" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M15 0C6.71573 0 0 6.71573 0 15C0 23.2843 15 45 15 45C15 45 30 23.2843 30 15C30 6.71573 23.2843 0 15 0Z" fill="#E74C3C" />\n      <circle cx="15" cy="15" r="7" fill="white" />\n    </svg>\n  ',e.style.width="30px",e.style.height="45px",e.style.cursor="pointer",e.style.filter="drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.5))",e}}),"/detail-page/:id":V(class{#u=null;constructor(){this.#u=new U({view:this,model:{getStoryDetail:g}})}async render(){return'\n      <section class="story-verse-container">\n        <div class="header">\n          <p class="instruction-text-detail">View Detail Post</p>\n          <a href="#/" class="back-btn">Back to Homepage</a>\n        </div>\n\n        <h1 class="story-title">POST DETAIL STORYVERSE</h1>\n\n        <div class="detail-container">\n          <div class="loading-indicator">Load story detail...</div>\n        </div>\n      </section>\n        '}async afterRender(){const e=this.getStoryIdFromUrl();await this.#u.init(e),this.setupBackButtonHandler(),this._setupBookmarkButtonHandler()}_setupBookmarkButtonHandler(){const e=document.getElementById("bookmarkButton");e&&e.addEventListener("click",(()=>{this.#u.handleBookmarkClick()}))}showBookmarkButton(e){const t=document.querySelector(".detail-container");let n='<div id="bookmark-container" style="margin-top: 20px;">';n+=e?'<button id="bookmarkButton" class="btn">Hapus dari Bookmark</button>':'<button id="bookmarkButton" class="btn">Simpan ke Bookmark</button>',n+="</div>";const o=document.getElementById("bookmark-container");o&&o.remove(),t.insertAdjacentHTML("beforeend",n),this._setupBookmarkButtonHandler()}getStoryIdFromUrl(){const e=window.location.hash.match(/#\/detail-page\/([^\/]+)/);return e?.[1]}setupBackButtonHandler(){const e=document.querySelector(".back-btn");e&&e.addEventListener("click",(e=>{e.preventDefault(),document.startViewTransition?document.startViewTransition((()=>{window.location.hash="#/"})):window.location.hash="#/"}))}showError(e){const t=document.querySelector(".detail-container");t&&(t.innerHTML=`\n            <div class="error-message">\n              <p>${e}</p>\n              <a href="#/" class="back-btn">Back to Home</a>\n            </div>\n          `)}showMapError(e){const t=document.getElementById("storyMap");t&&(t.innerHTML=`<p class="error-message">${e}</p>`)}loadMapScripts(){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.maptiler.com/maplibre-gl-js/v2.4.0/maplibre-gl.css",document.head.appendChild(e);const t=document.createElement("script");t.src="https://cdn.maptiler.com/maplibre-gl-js/v2.4.0/maplibre-gl.js",document.head.appendChild(t)}waitForMapToBeReady(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;window.maplibregl?this.initializeMap(e,t):n>0?setTimeout((()=>{this.waitForMapToBeReady(e,t,n-1)}),500):this.showMapError("Map cant be loaded.")}addStoryDetail(e){const t=document.querySelector(".detail-container");t&&(t.innerHTML=`\n        <div class="form-control-page">\n          <label class="form-label">Name</label>\n          <div class="input-container">\n            <div class="detail-value">${e.name||"Unnamed Story"}</div>\n          </div>\n        </div>\n\n        <div class="form-control-page">\n          <label class="form-label">Image Evidence</label>\n          <div class="image-slider-container">\n            <img src="${e.photoUrl}" class="story-image" alt="${e.description||"Uknown"}"/>\n          </div>\n        </div>\n\n        <div class="form-control-page">\n          <label class="form-label">Description</label>\n          <div class="input-container">\n            <div class="detail-value">${e.description||"The Story Uknown"}</div>\n          </div>\n        </div>\n\n        <div class="form-control-page">\n          <label class="form-label">Location Coordinates</label>\n          <div class="location-coords">\n            <input type="text" placeholder="latitude" class="coord-input" value="${e.lat||""}" readonly>\n            <input type="text" placeholder="longitude" class="coord-input" value="${e.lon||""}" readonly>\n          </div>\n        </div>\n\n        <div class="form-control-page">\n          <label class="form-label">Map Location</label>\n          <div class="location-map-container">\n            <div class="location-map" id="storyMap"></div>\n          </div>\n        </div>\n      `)}initializeMap(e,t){try{if(!window.maplibregl)return console.error("MapLibre is not loaded"),void this.showMapError("Map is not available.");const n=i.MAP_SERVICE_API_KEY,o=new maplibregl.Map({container:"storyMap",style:`https://api.maptiler.com/maps/streets/style.json?key=${n}`,center:[t,e],zoom:12});o.addControl(new maplibregl.NavigationControl),(new maplibregl.Marker).setLngLat([t,e]).setPopup(new maplibregl.Popup({offset:25}).setHTML(`\n            <div style="font-family: "Poppins", sans-serif; padding: 5px;">\n              <h4 style="margin: 0 0 5px 0;">Location</h4>\n              <p style="margin: 0;">Lat: ${e.toFixed(6)}</p>\n              <p style="margin: 0;">Lon: ${t.toFixed(6)}</p>\n            </div>\n          `)).addTo(o),o.on("error",(e=>{console.error("Map error:",e),this.showMapError("Invalid Latitude or Longitude...")}))}catch(e){console.error("Error initializing map:",e),this.showMapError("Invalid Latitude or Longitude...")}}}),"/bookmark":V(class{#u=null;async render(){return'\n      <section class="home-container">\n        <h1 class="story-title">Bookmarked Stories</h1>\n        <div id="gallery" class="gallery">\n          </div>\n      </section>\n    '}async afterRender(){this.#u=new K({view:this,model:j}),await this.#u.initialGallery()}populateBookmarkGallery(e){const t=document.getElementById("gallery");if(!e||0===e.length)return void(t.innerHTML='<div class="empty-gallery">You have no bookmarked stories.</div>');const n=e.map((e=>{const t=e.description.length>100?`${e.description.substring(0,100)}...`:e.description,n=new Date(e.createdAt).toLocaleDateString("id-ID");return`\n          <div class="photo-item">\n            <a href="#/detail-page/${e.id}" class="photo-container">\n              <img src="${e.photoUrl}" alt="${e.name}" />\n            </a>\n            <div class="photo-info">\n              <h3 class="photo-name">${e.name}</h3>\n              <p class="photo-description">${t}</p>\n              <div class="photo-date">${n}</div>\n            </div>\n          </div>\n        `})).join("");t.innerHTML=n}showLoading(){document.getElementById("gallery").innerHTML='<div class="loading-indicator">Loading stories...</div>'}hideLoading(){const e=document.querySelector(".loading-indicator");e&&e.remove()}populateGalleryError(e){document.getElementById("gallery").innerHTML=`<div class="error-message">${e}</div>`}})};function G(e){const t=(e.startsWith("/")?e.slice(1):e).split("/");return{resource:t[0]||null,id:t[1]||null}}function W(){return window.location.hash.slice(1)||"/"}const q=e=>{const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),o=new Uint8Array(n.length);for(let e=0;e<n.length;++e)o[e]=n.charCodeAt(e);return o};async function J(){return(await navigator.serviceWorker.ready).pushManager.getSubscription()}n(779);const Q=class{constructor(e){let{content:t,drawerButton:n,navigationDrawer:o}=e;this.content=t,this.drawerButton=n,this.navigationDrawer=o,this._currentPage=null,this._initAppShell()}async _initAppShell(){this._setupDrawer(),this._setupNavigation(),this._setupLogout(),await this._setupNotificationButton()}_setupDrawer(){this.drawerButton&&this.drawerButton.addEventListener("click",(e=>{this.navigationDrawer.classList.toggle("open"),e.stopPropagation()})),document.addEventListener("click",(e=>{this.navigationDrawer&&!this.navigationDrawer.contains(e.target)&&this.navigationDrawer.classList.contains("open")&&this.navigationDrawer.classList.remove("open")}))}_setupNavigation(){this._updateNavigation(),window.addEventListener("hashchange",(()=>{this._updateNavigation()}))}_updateNavigation(){const e=document.getElementById("logout-container");l()?e.style.display="block":e.style.display="none"}_setupLogout(){const e=document.getElementById("logout-button");e&&e.addEventListener("click",(e=>{e.preventDefault(),this._handleLogout()}))}_handleLogout(){s(),window.location.hash="#/login",this._updateNavigation(),this._setupNotificationButton()}async _setupNotificationButton(){const e=document.getElementById("notification-button-container");if(e)if(l()&&"serviceWorker"in navigator&&"PushManager"in window)try{await J()?(e.innerHTML='<a href="#" id="unsubscribe-button">Unsubscribe</a>',document.getElementById("unsubscribe-button").addEventListener("click",(async e=>{e.preventDefault(),await async function(){const e=await J();if(e)try{await w(e.endpoint),await e.unsubscribe(),alert("Successfully unsubscribed. You will no longer receive notifications.")}catch(e){console.error("Failed to unsubscribe :",e),alert("Failed to unsubscribe. Please try again later.")}else alert("You are not subscribed.")}(),await this._setupNotificationButton()}))):(e.innerHTML='<a href="#" id="subscribe-button">Subscribe</a>',document.getElementById("subscribe-button").addEventListener("click",(async e=>{e.preventDefault(),await async function(){if(!await async function(){const e=await Notification.requestPermission();return"denied"===e?(alert("Notification permission denied. Please enable notification permission in your browser settings.."),!1):"default"!==e||(alert("Notification permission default. Please enable notification permission in your browser settings."),!1)}())return;if(await J())return void alert("You are already subscribed.");const e=await navigator.serviceWorker.ready;try{const t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:q(i.VAPID_PUBLIC_KEY)});await y(t.toJSON()),alert("Successfully subscribed!")}catch(e){console.error("Failed to subscribe:",e),alert("Failed to subscribe.")}}(),await this._setupNotificationButton()})))}catch(t){console.error("Error setting up notification button:",t),e.innerHTML=""}else e.innerHTML=""}async renderPage(){const e=function(e){let t="/";return e.resource&&(t=`/${e.resource}`,e.id&&(t=`${t}/:id`)),t}(G(W())),t=z[e];if(t){if(!t.check||t.check())try{this._currentPage&&"function"==typeof this._currentPage.destroy&&this._currentPage.destroy();const e=t.page;this._currentPage=e;const n=G(W()),o=async()=>{this.content.innerHTML=await e.render(n),await e.afterRender(n),this._updateNavigation(),await this._setupNotificationButton()};document.startViewTransition?document.startViewTransition(o):await o()}catch(e){console.error("Error rendering page:",e),this.content.innerHTML="<p>Error memuat halaman.</p>"}}else this.content.innerHTML='\n        <section class="story-verse-container" style="text-align: center;">\n          <h1>404 - Page Not Found</h1>\n          <p>Sorry, the page you are looking for is not found.</p>\n          <a href="#/" class="back-btn">Kembali ke Home</a>\n        </section>\n      '}};document.addEventListener("DOMContentLoaded",(async()=>{const e=new Q({content:document.querySelector("#main-content"),drawerButton:document.querySelector("#drawer-button"),navigationDrawer:document.querySelector("#navigation-drawer")});await e.renderPage(),await async function(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/sw.bundle.js");console.log("Service Worker Successfully Registered.",e)}catch(e){console.error("Service Worker Registration Failed:",e)}else console.log("Service Worker not available.")}(),window.addEventListener("hashchange",(async()=>{await e.renderPage()}))}))})()})();